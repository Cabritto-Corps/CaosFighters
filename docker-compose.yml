services:
  backend:
    build:
      context: ./backend
      dockerfile: Dockerfile
    container_name: caosfighters-backend
    restart: unless-stopped
    env_file:
      - ./backend/env.txt
    environment:
      APP_URL: http://localhost:8000
    ports:
      - "8000:8000"

  backend-worker:
    build:
      context: ./backend
      dockerfile: Dockerfile
    container_name: caosfighters-backend-worker
    restart: unless-stopped
    env_file:
      - ./backend/env.txt
    command: php artisan queue:work --verbose --tries=3 --timeout=90
    depends_on:
      - backend

  backend-reverb:
    build:
      context: ./backend
      dockerfile: Dockerfile
    container_name: caosfighters-backend-reverb
    restart: unless-stopped
    env_file:
      - ./backend/env.txt
    command: php artisan reverb:start
    depends_on:
      - backend

  websocket:
    build:
      context: .
      dockerfile: Dockerfile.websocket
    container_name: caosfighters-websocket
    restart: unless-stopped
    environment:
      BACKEND_URL: http://backend:8000
      WS_PORT: 8080
    ports:
      - "8080:8080"
    depends_on:
      - backend



